var egret;!function(e){var t;!function(t){function i(i){if(!s){s=!0,i||(i={}),r(i.renderMode);try{e.Capabilities.$setNativeCapabilities(egret_native.getVersion())}catch(n){}var a=e.sys.$ticker,h=function(){a.update()};egret_native.setOnUpdate(h,a),e.sys.screenAdapter||(i.screenAdapter?e.sys.screenAdapter=i.screenAdapter:e.sys.screenAdapter=new e.sys.DefaultScreenAdapter);var u=new t.NativePlayer;o.push(u),u.$stage.dirtyRegionPolicy=e.DirtyRegionPolicy.OFF,e.sys.DisplayList.prototype.setDirtyRegionPolicy=function(){}}}function r(i){e.sys.CanvasRenderBuffer=t.WebGLRenderBuffer,e.sys.RenderBuffer=t.WebGLRenderBuffer,e.sys.systemRenderer=new t.WebGLRenderer,e.sys.canvasRenderer=new t.WebGLRenderer,e.sys.customHitTestBuffer=new t.WebGLRenderBuffer(3,3),e.sys.canvasHitTestBuffer=new t.WebGLRenderBuffer(3,3),e.Capabilities.$renderMode="webgl"}function n(){for(var e=o.length,t=0;e>t;t++)o[t].updateScreenSize()}function a(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i]);return t}t.$supportCanvas=egret_native.Canvas?!0:!1;var s=!1,o=[];e.warn=function(){console.warn.apply(console,a(arguments))},e.error=function(){console.error.apply(console,a(arguments))},e.assert=function(){console.assert.apply(console,a(arguments))},e.log=function(){console.log.apply(console,a(arguments))},e.runEgret=i,e.updateAllScreens=n}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){t.$supportCanvas=!0,e["native"].$supportCanvas=e.native2.$supportCanvas}(t=e["native"]||(e["native"]={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(t){function i(i,r,n,a,s){t.call(this),this.arrFps=[],this.arrLog=[],(r||n)&&(this.panelX=void 0===s.x?0:parseInt(s.x),this.panelY=void 0===s.y?0:parseInt(s.y),this._stage=i,this.showFps=r,this.showLog=n,this.fontColor=void 0===s.textColor?16777215:parseInt(s.textColor),this.fontSize=void 0===s.size?24:parseInt(s.size),this.bgAlpha=s.bgAlpha||.9,this.shape=new e.Shape,this.addChild(this.shape),r&&this.addFps(),n&&this.addLog())}__extends(i,t);var r=(__define,i),n=r.prototype;return n.addFps=function(){var t=new e.TextField;t.x=t.y=4,this.textFps=t,this.addChild(t),t.lineSpacing=2,t.size=this.fontSize,t.textColor=this.fontColor,t.textFlow=[{text:"0 FPS "+e.Capabilities.renderMode+"\n"},{text:"Draw: 0\nDirty: 0%\n"},{text:"Cost: "},{text:"0 ",style:{textColor:1638142}},{text:"0 ",style:{textColor:16776960}},{text:"0 ",style:{textColor:16711680}}]},n.addLog=function(){var t=new e.TextField;t.size=this.fontSize,t.textColor=this.fontColor,t.x=4,this.addChild(t),this.textLog=t},n.update=function(t){this.arrFps.push(t.fps);var i=0,r=this.arrFps.length;r>101&&(r=101,this.arrFps.shift());for(var n=this.arrFps[0],a=this.arrFps[0],s=0;r>s;s++){var o=this.arrFps[s];i+=o,n>o?n=o:o>a&&(a=o)}this.textFps.textFlow=[{text:t.fps+" FPS "+e.Capabilities.renderMode+"\n"},{text:"min"+n+" max"+a+" avg"+Math.floor(i/r)+"\n"},{text:"Draw: "+t.draw+"\nDirty: "+t.dirty+"%\n"},{text:"Cost: "},{text:t.costTicker+" ",style:{textColor:1638142}},{text:t.costDirty+" ",style:{textColor:16776960}},{text:t.costRender+" ",style:{textColor:16711680}}],this.updateLayout()},n.updateInfo=function(e){var t=0;if(this.showFps&&(t=this.textFps.height,this.textLog.y=t+4),this.arrLog.push(e),this.textLog.text=this.arrLog.join("\n"),this._stage.stageHeight>0)for(this.textLog.textWidth>this._stage.stageWidth-20-this.panelX&&(this.textLog.width=this._stage.stageWidth-20-this.panelX);this.textLog.textHeight>this._stage.stageHeight-t-20-this.panelY;)this.arrLog.shift(),this.textLog.text=this.arrLog.join("\n");this.updateLayout()},n.updateLayout=function(){if(e.Capabilities.runtimeType!=e.RuntimeType.NATIVE){var t=this.shape.$graphics;t.clear(),t.beginFill(0,this.bgAlpha),t.drawRect(0,0,this.width+8,this.height+8),t.endFill()}},i}(e.Sprite);t.NativeFps=i,e.registerClass(i,"egret.native2.NativeFps",["egret.FPSDisplay"]),e.FPSDisplay=i}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(t){function i(i){t.call(this),egret_native.pauseApp=function(){i.dispatchEvent(new e.Event(e.Event.DEACTIVATE)),egret_native.Audio.pauseBackgroundMusic(),egret_native.Audio.pauseAllEffects()},egret_native.resumeApp=function(){i.dispatchEvent(new e.Event(e.Event.ACTIVATE)),egret_native.Audio.resumeBackgroundMusic(),egret_native.Audio.resumeAllEffects()}}__extends(i,t);var r=(__define,i);r.prototype;return i}(e.HashObject);t.NativeHideHandler=i,e.registerClass(i,"egret.native2.NativeHideHandler")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(i){function r(){i.call(this),this.init(r.option)}__extends(r,i);var n=(__define,r),a=n.prototype;return a.init=function(i){i.showPaintRect=!1;var r=new e.Stage;r.$screen=this,r.$scaleMode=i.scaleMode,r.$maxTouches=i.maxTouches,r.textureScaleFactor=i.textureScaleFactor,r.frameRate=i.frameRate;var n=new e.sys.RenderBuffer(void 0,void 0,!0),a=n.surface;this.attachCanvas(a);var s=new t.NativeTouchHandler(r),o=new e.sys.Player(n,r,i.entryClassName);if(new t.NativeHideHandler(r),o.showPaintRect(i.showPaintRect),i.showFPS||i.showLog){for(var h=i.fpsStyles||"",u=h.split(","),c={},l=0;l<u.length;l++){var d=u[l].split(":");c[d[0]]=d[1]}i.fpsStyles=c,o.displayFPS(i.showFPS,i.showLog,i.logFilter,i.fpsStyles)}this.playerOption=i,this.$stage=r,this.player=o,this.nativeTouch=s,this.updateScreenSize(),this.updateMaxTouches(),o.start()},a.updateScreenSize=function(){var t=this.playerOption,i=egret_native.getDeviceWidth(),r=egret_native.getDeviceHeight();e.Capabilities.$boundingClientWidth=i,e.Capabilities.$boundingClientHeight=r;var n=e.sys.screenAdapter.calculateStageSize(this.$stage.$scaleMode,i,r,t.contentWidth,t.contentHeight),a=n.stageWidth,s=n.stageHeight,o=n.displayWidth,h=n.displayHeight,u=(r-h)/2,c=(i-o)/2;egret_native.setVisibleRect(c,u,o,h),egret_native.setDesignSize(a,s),this.player.updateStageSize(a,s)},a.setContentSize=function(e,t){var i=this.playerOption;i.contentWidth=e,i.contentHeight=t,this.updateScreenSize()},a.attachCanvas=function(e){egret_native.setScreenCanvas(e)},a.updateMaxTouches=function(){this.nativeTouch.$updateMaxTouches()},r}(e.HashObject);t.NativePlayer=i,e.registerClass(i,"egret.native2.NativePlayer",["egret.sys.Screen"])}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(t){function i(){t.apply(this,arguments),this._downCount=0,this._path=null,this._bytesTotal=0}__extends(i,t);var r=(__define,i),n=r.prototype;return n.load=function(e,t){this._downCount=0,this._path=e,this._bytesTotal=t,this.reload()},n.reload=function(){if(this._downCount>=3)return void this.downloadFileError();this._downCount++;var t=e.PromiseObject.create(),i=this;t.onSuccessFunc=function(){i.loadOver()},t.onErrorFunc=function(){i.reload()},t.downloadingSizeFunc=function(e){i.downloadingProgress(e)},egret_native.download(this._path,this._path,t)},n.downloadingProgress=function(t){e.ProgressEvent.dispatchProgressEvent(this,e.ProgressEvent.PROGRESS,t,this._bytesTotal)},n.downloadFileError=function(){this.dispatchEvent(new e.Event(e.IOErrorEvent.IO_ERROR))},n.loadOver=function(){this.dispatchEvent(new e.Event(e.Event.COMPLETE))},i}(e.EventDispatcher);t.NativeResourceLoader=i,e.registerClass(i,"egret.native2.NativeResourceLoader"),e.NativeResourceLoader=i}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function i(t,i){var r=e.sys.canvasHitTestBuffer,n=r.surface;return n}function r(t,r){try{var n=i(this,r),a=n.toDataURL(t);return a}catch(s){return e.$error(1033),null}}function n(t,r,n){try{var a=i(this,n);a.saveToFile(t,r)}catch(s){e.$error(1033)}}function a(t,i){return e.$error(1035),null}e.Texture.prototype.toDataURL=r,e.Texture.prototype.saveToFile=n,e.Texture.prototype.getPixel32=a}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(t){function i(i){t.call(this),this.$touch=new e.sys.TouchHandler(i);var r=this;egret_native.touchDown=function(e,t,i,n){r.$executeTouchCallback(e,t,i,n,r.$touch.onTouchBegin)},egret_native.touchMove=function(e,t,i,n){r.$executeTouchCallback(e,t,i,n,r.$touch.onTouchMove)},egret_native.touchUp=function(e,t,i,n){r.$executeTouchCallback(e,t,i,n,r.$touch.onTouchEnd)},egret_native.touchCancel=function(e,t,i,r){}}__extends(i,t);var r=(__define,i),n=r.prototype;return n.$executeTouchCallback=function(e,t,i,r,n){for(var a=0;e>a;a++){var s=t[a],o=i[a],h=r[a];n.call(this.$touch,o,h,s)}},n.$updateMaxTouches=function(){this.$touch.$initMaxTouches()},i}(e.HashObject);t.NativeTouchHandler=i,e.registerClass(i,"egret.native2.NativeTouchHandler")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function i(e){var t=egret_native.xmlStr2JsonStr(e),i=JSON.parse(t);return r(i,null)}function r(e,t){if("parsererror"==e.localName)throw new Error(e.textContent);var i=new a(e.localName,t,e.prefix,e.namespace,e.name),n=e.attributes,o=i.attributes;for(var h in n)o[h]=n[h];for(var u=e.children,c=u.length,l=i.children,d=0;c>d;d++){var f=u[d],v=f.nodeType,g=null;if(1==v)g=r(f,i);else if(3==v){var p=f.text.trim();p&&(g=new s(p,i))}g&&l.push(g)}return i}var n=function(){function e(e,t){this.nodeType=e,this.parent=t}var t=(__define,e);t.prototype;return e}();t.XMLNode=n,e.registerClass(n,"egret.native2.XMLNode");var a=function(e){function t(t,i,r,n,a){e.call(this,1,i),this.attributes={},this.children=[],this.localName=t,this.prefix=r,this.namespace=n,this.name=a}__extends(t,e);var i=(__define,t);i.prototype;return t}(n);t.XML=a,e.registerClass(a,"egret.native2.XML");var s=function(e){function t(t,i){e.call(this,3,i),this.text=t}__extends(t,e);var i=(__define,t);i.prototype;return t}(n);t.XMLText=s,e.registerClass(s,"egret.native2.XMLText"),e.XML={parse:i}}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(){function t(){this.onSuccessFunc=null,this.onSuccessThisObject=null,this.onErrorFunc=null,this.onErrorThisObject=null,this.downloadingSizeFunc=null,this.downloadingSizeThisObject=null,this.onResponseHeaderFunc=null,this.onResponseHeaderThisObject=null}var i=(__define,t),r=i.prototype;return t.create=function(){return t.promiseObjectList.length?t.promiseObjectList.pop():new e.PromiseObject},r.onSuccess=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];this.onSuccessFunc&&this.onSuccessFunc.apply(this.onSuccessThisObject,e),this.destroy()},r.onError=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];this.onErrorFunc&&this.onErrorFunc.apply(this.onErrorThisObject,e),this.destroy()},r.downloadingSize=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];this.downloadingSizeFunc&&this.downloadingSizeFunc.apply(this.downloadingSizeThisObject,e)},r.onResponseHeader=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];this.onResponseHeaderFunc&&this.onResponseHeaderFunc.apply(this.onResponseHeaderThisObject,e)},r.destroy=function(){this.onSuccessFunc=void 0,this.onSuccessThisObject=void 0,this.onErrorFunc=void 0,this.onErrorThisObject=void 0,this.downloadingSizeFunc=void 0,this.downloadingSizeThisObject=void 0,this.onResponseHeaderFunc=void 0,this.onResponseHeaderThisObject=void 0,t.promiseObjectList.push(this)},t.promiseObjectList=[],t}();t.PromiseObject=i,e.registerClass(i,"egret.native2.PromiseObject"),e.PromiseObject=i}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function i(t){var i=JSON.parse(t),n=i.functionName,a=r[n];if(a){var s=i.value;a.call(null,s)}else e.$warn(1004,n)}var r={},n=function(){function e(){}var t=(__define,e);t.prototype;return e.call=function(e,t){var i={};i.functionName=e,i.value=t,egret_native.sendInfoToPlugin(JSON.stringify(i))},e.addCallback=function(e,t){r[e]=t},e}();t.NativeExternalInterface=n,e.registerClass(n,"egret.native2.NativeExternalInterface",["egret.ExternalInterface"]),e.ExternalInterface=n,egret_native.receivedPluginInfo=i}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i;!function(i){function r(e){return u[e]}function n(t,i){i=void 0===i?"undefined":null===i?"null":i.toString(),u[t]=i;try{return o(),!0}catch(r){return e.$warn(1018,t,i),!1}}function a(e){delete u[e],o()}function s(){for(var e in u)delete u[e];o()}function o(){egret_native.saveRecord(h,JSON.stringify(u))}var h="LocalStorage.local",u={};if(egret_native.isRecordExists(h)){var c=egret_native.loadRecord(h);try{u=JSON.parse(c)}catch(l){u={}}}else u={};t.getItem=r,t.setItem=n,t.removeItem=a,t.clear=s}(i=t.native2||(t.native2={}))}(t=e.localStorage||(e.localStorage={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(i){function r(){i.call(this),this.loaded=!1}__extends(r,i);var n=__define,a=r,s=a.prototype;return n(s,"length",function(){throw new Error("sound length not supported")}),s.load=function(i){function r(){var r=t.PromiseObject.create();r.onSuccessFunc=n,r.onErrorFunc=function(){e.IOErrorEvent.dispatchIOErrorEvent(a)},egret_native.download(i,i,r)}function n(){a.loaded=!0,a.preload()}var a=this;this.url=i,egret_native.isFileExists(i)?__global.setTimeout?__global.setTimeout(n,0):e.$callAsync(n,a):r()},s.preload=function(){var t=this;if(t.type==e.Sound.EFFECT){var i=new e.PromiseObject;i.onSuccessFunc=function(i){t.dispatchEventWith(e.Event.COMPLETE)},egret_native.Audio.preloadEffectAsync(t.url,i)}else t.dispatchEventWith(e.Event.COMPLETE)},s.play=function(i,r){i=+i||0,r=+r||0;var n=new t.NaSoundChannel;return n.$url=this.url,n.$loops=r,n.$type=this.type,n.$startTime=i,n.$play(),e.sys.$pushSoundChannel(n),n},s.close=function(){},r.MUSIC="music",r.EFFECT="effect",r}(e.EventDispatcher);t.NaSound=i,e.registerClass(i,"egret.native2.NaSound",["egret.Sound"]),__global.Audio||(e.Sound=i)}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(t){function i(){t.call(this),this.$startTime=0,this.isStopped=!1,this._startTime=0}__extends(i,t);var r=__define,n=i,a=n.prototype;return a.$play=function(){this.isStopped=!1,this.$type==e.Sound.EFFECT?this._effectId=egret_native.Audio.playEffect(this.$url,1!=this.$loops):(i.currentPath=this.$url,egret_native.Audio.playBackgroundMusic(this.$url,1!=this.$loops)),this._startTime=Date.now()},a.stop=function(){this.isStopped||e.sys.$popSoundChannel(this),this.isStopped=!0,this.$type==e.Sound.EFFECT?this._effectId&&(egret_native.Audio.stopEffect(this._effectId),this._effectId=null):this.$url==i.currentPath&&egret_native.Audio.stopBackgroundMusic(!1)},r(a,"volume",function(){return this.$type==e.Sound.EFFECT?egret_native.Audio.getEffectsVolume():egret_native.Audio.getBackgroundMusicVolume()},function(t){this.$type==e.Sound.EFFECT?egret_native.Audio.setEffectsVolume(t):egret_native.Audio.setBackgroundMusicVolume(t)}),r(a,"position",function(){return(Date.now()-this._startTime)/1e3}),i}(e.EventDispatcher);t.NaSoundChannel=i,e.registerClass(i,"egret.native2.NaSoundChannel",["egret.SoundChannel","egret.IEventDispatcher"])}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(i){function r(){i.call(this),this.loaded=!1}__extends(r,i);var n=__define,a=r,s=a.prototype;return n(s,"length",function(){if(this.originAudio)return this.originAudio.duration;throw new Error("sound not loaded!")}),s.load=function(i){function n(){var e=t.PromiseObject.create();e.onSuccessFunc=a,e.onErrorFunc=o,egret_native.download(i,i,e)}function a(){c.load(),r.$recycle(i,c)}function s(){h(),u.loaded=!0,u.dispatchEventWith(e.Event.COMPLETE)}function o(){h(),u.dispatchEventWith(e.IOErrorEvent.IO_ERROR)}function h(){c.removeEventListener("canplaythrough",s),c.removeEventListener("error",o)}var u=this;this.url=i;var c=new Audio(i);c.addEventListener("canplaythrough",s),c.addEventListener("error",o),this.originAudio=c,egret_native.isFileExists(i)?a():n()},s.play=function(i,n){i=+i||0,n=+n||0;var a=r.$pop(this.url);null==a&&(a=new Audio(this.url)),a.autoplay=!0;var s=new t.NativeSoundChannel(a);return s.$url=this.url,s.$loops=n,s.$startTime=i,s.$play(),e.sys.$pushSoundChannel(s),s},s.close=function(){0==this.loaded&&this.originAudio&&(this.originAudio.src=""),this.originAudio&&(this.originAudio=null),r.$clear(this.url)},r.$clear=function(e){var t=r.audios[e];t&&(t.length=0)},r.$pop=function(e){var t=r.audios[e];return t&&t.length>0?t.pop():null},r.$recycle=function(e,t){var i=r.audios[e];null==r.audios[e]&&(i=r.audios[e]=[]),i.push(t)},r.MUSIC="music",r.EFFECT="effect",r.audios={},r}(e.EventDispatcher);t.NativeSound=i,e.registerClass(i,"egret.native2.NativeSound",["egret.Sound"]),__global.Audio&&(e.Sound=i)}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(i){function r(t){var r=this;i.call(this),this.$startTime=0,this.audio=null,this.isStopped=!1,this.onPlayEnd=function(){return 1==r.$loops?(r.stop(),void r.dispatchEventWith(e.Event.SOUND_COMPLETE)):(r.$loops>0&&r.$loops--,void r.$play())},t.addEventListener("ended",this.onPlayEnd),this.audio=t}__extends(r,i);var n=__define,a=r,s=a.prototype;return s.$play=function(){if(this.isStopped)return void e.$error(1036);try{this.audio.currentTime=this.$startTime}catch(t){}finally{this.audio.play()}},s.stop=function(){if(this.audio){this.isStopped||e.sys.$popSoundChannel(this),this.isStopped=!0;var i=this.audio;i.pause(),i.removeEventListener("ended",this.onPlayEnd),this.audio=null,t.NativeSound.$recycle(this.$url,i)}},n(s,"volume",function(){return this.audio?this.audio.volume:1},function(t){return this.isStopped?void e.$error(1036):void(this.audio&&(this.audio.volume=t))}),n(s,"position",function(){return this.audio?this.audio.currentTime:0}),r}(e.EventDispatcher);t.NativeSoundChannel=i,e.registerClass(i,"egret.native2.NativeSoundChannel",["egret.SoundChannel","egret.IEventDispatcher"])}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(i){function r(t,r){void 0===r&&(r=!0),i.call(this),this.loaded=!1,this.loading=!1,this.loop=!1,this.isPlayed=!1,this.firstPlay=!0,this.src="",this._fullscreen=!0,this._bitmapData=null,this.paused=!1,this.isAddToStage=!1,this.heightSet=0,this.widthSet=0,this.$renderNode=new e.sys.BitmapNode,this.cache=r,__global.Video||e.$error(1044),t&&this.load(t,r)}__extends(r,i);var n=__define,a=r,s=a.prototype;return s.load=function(t,i){if(void 0===i&&(i=!0),!this.loading)if(0==t.indexOf("/")&&(t=t.slice(1,t.length)),this.src=t,this.loading=!0,this.loaded=!1,i&&!egret_native.isFileExists(t)){var r=this,n=e.PromiseObject.create();n.onSuccessFunc=function(){r.loadEnd()},n.onErrorFunc=function(){e.$warn(1048),r.dispatchEventWith(e.IOErrorEvent.IO_ERROR)},egret_native.download(t,t,n)}else this.loadEnd()},s.loadEnd=function(){function t(){a.setVideoRect(0,0,1,1),a.play()}function i(){a.setVideoRect(0,0,1,1),__global.setTimeout(function(){a.pause(),s._fullscreen&&(a.fullScreen=!0),a.currentTime=0,s.originVideo=a,s.loaded=!0,s.loading=!1,n(),s.dispatchEventWith(e.Event.COMPLETE),a.addEventListener("pause",function(){s.paused=!0}),a.addEventListener("playing",function(){s.paused=!1}),a.addEventListener("ended",function(){s.dispatchEventWith(e.Event.ENDED),s.loop&&s.play(0,!0)})},1)}function r(){n(),s.dispatchEventWith(e.IOErrorEvent.IO_ERROR)}function n(){a.removeEventListener("canplaythrough",t),a.removeEventListener("error",r),a.removeEventListener("playing",i)}var a=new __global.Video(this.src);a.setVideoRect(0,0,1,1),a.setKeepRatio(!1),a.addEventListener("canplaythrough",t),a.addEventListener("error",r),a.addEventListener("playing",i),a.load();var s=this},s.play=function(t,i){var r=this;if(void 0===i&&(i=!1),this.loop=i,!this.loaded)return this.load(this.src),void this.once(e.Event.COMPLETE,function(e){return r.play(t,i)},this);var n=!1;void 0!=t&&t!=this.originVideo.currentTime&&(this.originVideo.currentTime=t||0,n=!0),this.startPlay(n)},s.startPlay=function(t){void 0===t&&(t=!1),this.isAddToStage&&this.loaded&&(this.firstPlay=!1,this.setVideoSize(),this.isPlayed=!0,!t&&this.paused&&0!=this.position?this.originVideo.resume():this.originVideo.play(),e.startTick(this.markDirty,this))},s.stopPlay=function(){e.stopTick(this.markDirty,this),this.isPlayed&&(this.isPlayed=!1,this.originVideo.pause())},s.close=function(){this.originVideo&&this.originVideo.destroy(),this.loaded=!1,this.loading=!1,this.originVideo=null,this.loop=!1,this.src=null},n(s,"poster",function(){return this.posterUrl},function(i){var r=this;this.posterUrl=i;var n=new t.NativeImageLoader;n.load(i),n.addEventListener(e.Event.COMPLETE,function(){r.posterData=n.data,r.markDirty(),r.$invalidateContentBounds()},this)}),n(s,"fullscreen",function(){return this.originVideo?this.originVideo.fullScreen:this._fullscreen},function(e){this._fullscreen=e,this.originVideo&&(this.originVideo.fullScreen=e)}),n(s,"volume",function(){return this.loaded?this.originVideo.volume:0},function(e){this.loaded&&(this.originVideo.volume=e)}),n(s,"position",function(){return this.originVideo.currentTime},function(e){this.loaded&&(this.originVideo.currentTime=e)}),s.pause=function(){this.originVideo.pause()},n(s,"bitmapData",function(){return this._bitmapData}),n(s,"length",function(){if(this.loaded)return this.originVideo.duration;throw new Error("Video not loaded!")}),s.$onAddToStage=function(e,t){this.isAddToStage=!0,this.originVideo&&this.originVideo.setVideoVisible(!0),this.$invalidate(),this.$invalidateContentBounds(),i.prototype.$onAddToStage.call(this,e,t)},s.$onRemoveFromStage=function(){this.isAddToStage=!1,this.originVideo&&(this.stopPlay(),this.originVideo.setVideoVisible(!1)),i.prototype.$onRemoveFromStage.call(this)},s.getPlayWidth=function(){return isNaN(this.widthSet)?this.bitmapData?this.bitmapData.width:this.posterData?this.posterData.width:0/0:this.widthSet},s.getPlayHeight=function(){return isNaN(this.heightSet)?this.bitmapData?this.bitmapData.height:this.posterData?this.posterData.height:0/0:this.heightSet},s.$setHeight=function(e){return this.heightSet=+e||0,this.setVideoSize(),this.$invalidate(),this.$invalidateContentBounds(),i.prototype.$setHeight.call(this,e)},s.$setWidth=function(e){return this.widthSet=+e||0,this.setVideoSize(),this.$invalidate(),this.$invalidateContentBounds(),i.prototype.$setWidth.call(this,e)},s.$setX=function(e){var t=i.prototype.$setX.call(this,e);return this.setVideoSize(),t},s.$setY=function(e){var t=i.prototype.$setY.call(this,e);return this.setVideoSize(),t},s.setVideoSize=function(){var e=this.originVideo;e&&!this.fullscreen&&(this.firstPlay?e.setVideoRect(this.x,this.y,0,0):e.setVideoRect(this.x,this.y,this.widthSet,this.heightSet))},s.$measureContentBounds=function(e){var t=this.posterData;t?e.setTo(0,0,this.getPlayWidth(),this.getPlayHeight()):e.setEmpty()},s.$render=function(){var e=this.$renderNode,t=this.posterData,i=this.getPlayWidth(),r=this.getPlayHeight();0>=i||0>=r||(!this.isPlayed&&t?(e.image=t,e.drawImage(0,0,t.width,t.height,0,0,i,r)):this.isPlayed&&this.setVideoSize())},s.markDirty=function(){return this.$invalidate(),!0},r}(e.DisplayObject);t.NativeVideo=i,e.registerClass(i,"egret.native2.NativeVideo",["egret.Video"])}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(i){function r(){i.call(this),this._url="",this._method="",this.urlData={},this.responseHeader=""}__extends(r,i);var n=__define,a=r,s=a.prototype;return n(s,"response",function(){return this._response}),n(s,"responseType",function(){return this._responseType},function(e){this._responseType=e}),n(s,"withCredentials",function(){return this._withCredentials},function(e){this._withCredentials=e}),s.open=function(e,t){void 0===t&&(t="GET"),this._url=e,this._method=t},s.send=function(i){function r(){var t=new e.PromiseObject;t.onSuccessFunc=function(t){a._response=t,e.Event.dispatchEvent(a,e.Event.COMPLETE)},t.onErrorFunc=function(){e.Event.dispatchEvent(a,e.IOErrorEvent.IO_ERROR)},a._responseType==e.HttpResponseType.ARRAY_BUFFER?egret_native.readFileAsync(a._url,t,"ArrayBuffer"):egret_native.readFileAsync(a._url,t)}function n(){var i=t.PromiseObject.create();i.onSuccessFunc=r,i.onErrorFunc=function(){e.Event.dispatchEvent(a,e.IOErrorEvent.IO_ERROR)},i.onResponseHeaderFunc=this.onResponseHeader,i.onResponseHeaderThisObject=this,egret_native.download(a._url,a._url,i)}var a=this;if(a.isNetUrl(a._url)){a.urlData.type=a._method,a._method==e.HttpMethod.POST&&i?i instanceof ArrayBuffer?a.urlData.data=i:a.urlData.data=i.toString():delete a.urlData.data,a._responseType==e.HttpResponseType.ARRAY_BUFFER?a.urlData.binary=!0:a.urlData.header=!1,this.headerObj?a.urlData.header=JSON.stringify(this.headerObj):delete a.urlData.header;var s=t.PromiseObject.create();s.onSuccessFunc=function(t){a._response=t,e.callLater(e.Event.dispatchEvent,e.Event,a,e.Event.COMPLETE)},s.onErrorFunc=function(t){e.$warn(1019,t),e.Event.dispatchEvent(a,e.IOErrorEvent.IO_ERROR)},s.onResponseHeaderFunc=this.onResponseHeader,s.onResponseHeaderThisObject=this,egret_native.requireHttp(a._url,a.urlData,s)}else egret_native.isFileExists(a._url)?r():n()},s.isNetUrl=function(e){return-1!=e.indexOf("http://")||-1!=e.indexOf("HTTP://")},s.abort=function(){},s.onResponseHeader=function(e){this.responseHeader=e},s.getAllResponseHeaders=function(){return this.responseHeader},s.setRequestHeader=function(e,t){this.headerObj||(this.headerObj={}),this.headerObj[e]=t},s.getResponseHeader=function(e){return""},r}(e.EventDispatcher);t.NativeHttpRequest=i,e.registerClass(i,"egret.native2.NativeHttpRequest",["egret.HttpRequest"]),e.HttpRequest=i}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(t){function i(){t.apply(this,arguments),this.data=null,this._crossOrigin=null}__extends(i,t);var r=__define,n=i,a=n.prototype;return r(a,"crossOrigin",function(){return this._crossOrigin},function(e){this._crossOrigin=e}),a.load=function(e){this.check(e)},a.check=function(e){var t=this;t.isNetUrl(e)?t.download(e):egret_native.isFileExists(e)?t.loadTexture(e):t.download(e)},a.download=function(t){var i=this,r=e.PromiseObject.create();r.onSuccessFunc=function(){i.loadTexture(t)},r.onErrorFunc=function(){i.dispatchEventWith(e.IOErrorEvent.IO_ERROR)},egret_native.download(t,t,r)},a.loadTexture=function(t){var i=this,r=new e.PromiseObject;r.onSuccessFunc=function(t){i.data=new e.BitmapData(t),i.dispatchEventWith(e.Event.COMPLETE)},r.onErrorFunc=function(){i.dispatchEventWith(e.IOErrorEvent.IO_ERROR)},egret_native.createRawImage(t,r)},a.isNetUrl=function(e){return-1!=e.indexOf("http://")||-1!=e.indexOf("HTTP://")},i.crossOrigin=null,i}(e.EventDispatcher);t.NativeImageLoader=i,e.registerClass(i,"egret.native2.NativeImageLoader",["egret.ImageLoader"]),e.ImageLoader=i}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(t){function i(){t.call(this),this.textValue="",this.colorValue=16777215,this.isFinishDown=!1,this.textValue=""}__extends(i,t);var r=(__define,i),n=r.prototype;return n.$getText=function(){return this.textValue||(this.textValue=""),this.textValue},n.$setText=function(e){return this.textValue=e,!0},n.$setColor=function(e){return this.colorValue=e,!0},n.$onBlur=function(){},n.showScreenKeyboard=function(){var t=this;t.dispatchEvent(new e.Event("focus")),e.Event.dispatchEvent(t,"focus",!1,{showing:!0}),egret_native.EGT_TextInput=function(i){t.$textfield.multiline?(t.textValue=i,t.dispatchEvent(new e.Event("updateText")),t.isFinishDown&&(t.isFinishDown=!1,t.dispatchEvent(new e.Event("blur")))):(t.textValue=i.replace(/[\n|\r]/,""),egret_native.TextInputOp.setKeybordOpen(!1),t.dispatchEvent(new e.Event("updateText")),t.dispatchEvent(new e.Event("blur")))},egret_native.EGT_keyboardFinish=function(){t.$textfield.multiline&&(t.isFinishDown=!0)}},n.$show=function(){var t=this;egret_native.TextInputOp.setKeybordOpen(!1),egret_native.EGT_getTextEditerContentText=function(){return t.$getText()},egret_native.EGT_keyboardDidShow=function(){t.showScreenKeyboard(),egret_native.EGT_keyboardDidShow=function(){}},egret_native.EGT_keyboardDidHide=function(){},egret_native.EGT_deleteBackward=function(){};var i=this.$textfield,r=i.$TextField,n=r[37],a=r[30]?0:6,s=-1;n==e.TextFieldInputType.PASSWORD?s=0:n==e.TextFieldInputType.TEL&&(a=3);var o=1,h=r[21]<=0?-1:r[21],u=i.$getRenderNode(),c=u.renderMatrix;egret_native.TextInputOp.setKeybordOpen(!0,JSON.stringify({inputMode:a,inputFlag:s,returnType:o,maxLength:h,x:c.tx,y:c.ty,width:i.width,height:i.height,font_size:r[0],font_color:r[2],textAlign:r[9],verticalAlign:r[10]}))},n.$hide=function(){egret_native.TextInputOp.setKeybordOpen(!1),this.dispatchEvent(new e.Event("blur"))},n.$resetStageText=function(){},n.$addToStage=function(){},n.$removeFromStage=function(){},n.$setTextField=function(e){return this.$textfield=e,!0},i}(e.EventDispatcher);t.NativeStageText=i,e.registerClass(i,"egret.native2.NativeStageText",["egret.StageText"]),e.StageText=i}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function i(e,t,i,r,n){return 0}e.sys.measureText=i}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(e){}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function i(e,t){e=isNaN(e)?480:e,t=isNaN(t)?800:t;var i=new egret_native.Canvas(e,t),r=i.getContext("2d");if(void 0===r.imageSmoothingEnabled){for(var n=["webkitImageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled"],a=n.length-1;a>=0;a--){var s=n[a];if(void 0!==r[s])break}try{Object.defineProperty(r,"imageSmoothingEnabled",{get:function(){return this[s]},set:function(e){this[s]=e}})}catch(o){r.imageSmoothingEnabled=r[s]}}return i}var r,n=function(){function e(e,t,i){}var t=__define,n=e,a=n.prototype;return t(a,"width",function(){return this.surface.width}),t(a,"height",function(){return this.surface.height}),a.resize=function(e,t,i){var r=this.surface;if(i){var n=!1;r.width<e&&(r.width=e,n=!0),r.height<t&&(r.height=t,n=!0),n||(this.context.globalCompositeOperation="source-over",this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1)}else r.width!=e&&(r.width=e),r.height!=t&&(r.height=t);this.clear()},a.resizeTo=function(e,t,n,a){r||(r=i());var s=(this.context,this.surface),o=r,h=o.getContext("2d");r=s,this.context=h,this.surface=o,o.width=Math.max(e,257),o.height=Math.max(t,257),h.setTransform(1,0,0,1,0,0),h.drawImage(s,n,a),s.height=1,s.width=1},a.setDirtyRegionPolicy=function(e){},a.beginClip=function(e,t,i){t=+t||0,i=+i||0;var r=this.context;r.save(),r.beginPath(),r.setTransform(1,0,0,1,t,i);for(var n=e.length,a=0;n>a;a++){var s=e[a];r.clearRect(s.minX,s.minY,s.width,s.height),r.rect(s.minX,s.minY,s.width,s.height)}r.clip()},a.endClip=function(){this.context.restore()},a.getPixel=function(e,t){return this.context.getImageData(e,t,1,1).data},a.toDataURL=function(e,t){return this.surface.toDataURL(e,t)},a.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.surface.width,this.surface.height)},a.destroy=function(){this.surface.width=this.surface.height=0},e}();t.CanvasRenderBuffer=n,e.registerClass(n,"egret.native2.CanvasRenderBuffer",["egret.sys.RenderBuffer"])}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(){function e(){this.drawData=[],this.drawDataLen=0}var t=(__define,e),i=t.prototype;return i.pushDrawRect=function(){if(0==this.drawDataLen||1!=this.drawData[this.drawDataLen-1].type){var e=this.drawData[this.drawDataLen]||{};e.type=1,e.count=0,this.drawData[this.drawDataLen]=e,this.drawDataLen++}this.drawData[this.drawDataLen-1].count+=2},i.pushDrawTexture=function(e,t,i,r,n){if(void 0===t&&(t=2),i){var a=this.drawData[this.drawDataLen]||{};a.type=0,a.texture=e,a.filter=i,a.count=t,a.textureWidth=r,a.textureHeight=n,this.drawData[this.drawDataLen]=a,this.drawDataLen++
}else{if(0==this.drawDataLen||0!=this.drawData[this.drawDataLen-1].type||e!=this.drawData[this.drawDataLen-1].texture||this.drawData[this.drawDataLen-1].filter){var a=this.drawData[this.drawDataLen]||{};a.type=0,a.texture=e,a.count=0,this.drawData[this.drawDataLen]=a,this.drawDataLen++}this.drawData[this.drawDataLen-1].count+=t}},i.pushPushMask=function(e){void 0===e&&(e=1);var t=this.drawData[this.drawDataLen]||{};t.type=2,t.count=2*e,this.drawData[this.drawDataLen]=t,this.drawDataLen++},i.pushPopMask=function(e){void 0===e&&(e=1);var t=this.drawData[this.drawDataLen]||{};t.type=3,t.count=2*e,this.drawData[this.drawDataLen]=t,this.drawDataLen++},i.pushSetBlend=function(e){for(var t=this.drawDataLen,i=!1,r=t-1;r>=0;r--){var n=this.drawData[r];if(n){if((0==n.type||1==n.type)&&(i=!0),!i&&4==n.type){this.drawData.splice(r,1),this.drawDataLen--;continue}if(4==n.type){if(n.value==e)return;break}}}var a=this.drawData[this.drawDataLen]||{};a.type=4,a.value=e,this.drawData[this.drawDataLen]=a,this.drawDataLen++},i.pushResize=function(e,t,i){var r=this.drawData[this.drawDataLen]||{};r.type=5,r.buffer=e,r.width=t,r.height=i,this.drawData[this.drawDataLen]=r,this.drawDataLen++},i.pushClearColor=function(){var e=this.drawData[this.drawDataLen]||{};e.type=6,this.drawData[this.drawDataLen]=e,this.drawDataLen++},i.pushActivateBuffer=function(e){for(var t=this.drawDataLen,i=!1,r=t-1;r>=0;r--){var n=this.drawData[r];!n||(4!=n.type&&7!=n.type&&(i=!0),i||7!=n.type)||(this.drawData.splice(r,1),this.drawDataLen--)}var a=this.drawData[this.drawDataLen]||{};a.type=7,a.buffer=e,a.width=e.rootRenderTarget.width,a.height=e.rootRenderTarget.height,this.drawData[this.drawDataLen]=a,this.drawDataLen++},i.pushEnableScissor=function(e,t,i,r){var n=this.drawData[this.drawDataLen]||{};n.type=8,n.x=e,n.y=t,n.width=i,n.height=r,this.drawData[this.drawDataLen]=n,this.drawDataLen++},i.pushDisableScissor=function(){var e=this.drawData[this.drawDataLen]||{};e.type=9,this.drawData[this.drawDataLen]=e,this.drawDataLen++},i.clear=function(){for(var e=0;e<this.drawDataLen;e++){var t=this.drawData[e];t.type=0,t.count=0,t.texture=null,t.filter=null,t.uv=null,t.value="",t.buffer=null,t.width=0,t.height=0}this.drawDataLen=0},e}();t.WebGLDrawCmdManager=i,e.registerClass(i,"egret.native2.WebGLDrawCmdManager")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(){function i(i,r,n){if(this.globalAlpha=1,this.stencilState=!1,this.$stencilList=[],this.stencilHandleCount=0,this.$scissorState=!1,this.scissorRect=new e.Rectangle,this.$hasScissor=!0,this.dirtyRegionPolicy=!0,this._dirtyRegionPolicy=!0,this.$drawCalls=0,this.$computeDrawCall=!1,this.globalMatrix=new e.Matrix,this.savedGlobalMatrix=new e.Matrix,this.context=t.WebGLRenderContext.getInstance(i,r),this.rootRenderTarget=new t.WebGLRenderTarget(this.context.context,3,3),i&&r&&this.resize(i,r),this.root=n,this.root)this.context.pushBuffer(this),this.surface=this.context.surface;else{var a=this.context.activatedBuffer;a&&a.rootRenderTarget.activate(),this.surface=this.rootRenderTarget}}var n=__define,a=i,s=a.prototype;return s.enableStencil=function(){this.stencilState||(this.context.enableStencilTest(),this.stencilState=!0)},s.disableStencil=function(){this.stencilState&&(this.context.disableStencilTest(),this.stencilState=!1)},s.restoreStencil=function(){this.stencilState?this.context.enableStencilTest():this.context.disableStencilTest()},s.enableScissor=function(e,t,i,r){this.$scissorState||(this.$scissorState=!0,this.scissorRect.setTo(e,t,i,r),this.context.enableScissorTest(this.scissorRect))},s.disableScissor=function(){this.$scissorState&&(this.$scissorState=!1,this.scissorRect.setEmpty(),this.context.disableScissorTest())},s.restoreScissor=function(){this.$scissorState?this.context.enableScissorTest(this.scissorRect):this.context.disableScissorTest()},n(s,"width",function(){return this.rootRenderTarget.width}),n(s,"height",function(){return this.rootRenderTarget.height}),s.resize=function(e,t,i){this.context.pushBuffer(this),e=e||1,t=t||1,(e!=this.rootRenderTarget.width||t!=this.rootRenderTarget.height)&&(this.context.drawCmdManager.pushResize(this,e,t),this.rootRenderTarget.width=e,this.rootRenderTarget.height=t),this.root&&this.context.resize(e,t,i),this.context.clear(),this.context.popBuffer()},s.resizeTo=function(e,t,r,n){this.context.pushBuffer(this);var a=this.rootRenderTarget.width,s=this.rootRenderTarget.height,o=i.create(a,s);this.context.pushBuffer(o),this.context.drawImage(this.rootRenderTarget,0,0,a,s,0,0,a,s,a,s),this.context.popBuffer(),this.resize(e,t),this.setTransform(1,0,0,1,0,0),this.context.drawImage(o.rootRenderTarget,0,0,a,s,r,n,a,s,a,s),i.release(o),this.context.popBuffer()},s.setDirtyRegionPolicy=function(e){this.dirtyRegionPolicy="on"==e},s.beginClip=function(e,t,i){this.context.pushBuffer(this),this.root&&(this._dirtyRegionPolicy?(this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate()):(this.rootRenderTarget.useFrameBuffer=!1,this.rootRenderTarget.activate(),this.context.clear())),t=+t||0,i=+i||0,this.setTransform(1,0,0,1,t,i);var r=e.length;if(1==r&&0==e[0].minX&&0==e[0].minY&&e[0].width==this.rootRenderTarget.width&&e[0].height==this.rootRenderTarget.height)return this.maskPushed=!1,this.rootRenderTarget.useFrameBuffer&&this.context.clear(),void this.context.popBuffer();for(var n=0;r>n;n++){var a=e[n];this.context.clearRect(a.minX,a.minY,a.width,a.height)}if(r>0){if(this.$hasScissor||1!=r)this.scissorEnabled=!1;else{var a=e[0];e=e.slice(1);var s=a.minX+t,o=a.minY+i,h=a.width,u=a.height;this.context.enableScissor(s,-o-u+this.height,h,u),this.scissorEnabled=!0}e.length>0?(this.context.pushMask(e),this.maskPushed=!0):this.maskPushed=!1,this.offsetX=t,this.offsetY=i}else this.maskPushed=!1;this.context.popBuffer()},s.endClip=function(){(this.maskPushed||this.scissorEnabled)&&(this.context.pushBuffer(this),this.maskPushed&&(this.setTransform(1,0,0,1,this.offsetX,this.offsetY),this.context.popMask()),this.scissorEnabled&&this.context.disableScissor(),this.context.popBuffer())},s.getPixel=function(e,t){var i=new Uint8Array(4),r=this.rootRenderTarget.useFrameBuffer;return this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate(),this.context.getPixels(e,t,1,1,i),this.rootRenderTarget.useFrameBuffer=r,this.rootRenderTarget.activate(),i},s.toDataURL=function(e,t){return this.context.surface.toDataURL(e,t)},s.destroy=function(){this.context.destroy()},s.onRenderFinish=function(){this.$drawCalls=0,this.root&&(!this._dirtyRegionPolicy&&this.dirtyRegionPolicy&&this.drawSurfaceToFrameBuffer(0,0,this.rootRenderTarget.width,this.rootRenderTarget.height,0,0,this.rootRenderTarget.width,this.rootRenderTarget.height,!0),this._dirtyRegionPolicy&&this.drawFrameBufferToSurface(0,0,this.rootRenderTarget.width,this.rootRenderTarget.height,0,0,this.rootRenderTarget.width,this.rootRenderTarget.height),this._dirtyRegionPolicy=this.dirtyRegionPolicy)},s.drawFrameBufferToSurface=function(e,t,i,r,n,a,s,o,h){void 0===h&&(h=!1),this.rootRenderTarget.useFrameBuffer=!1,this.rootRenderTarget.activate(),this.context.disableStencilTest(),this.context.disableScissorTest(),this.setTransform(1,0,0,1,0,0),this.globalAlpha=1,this.context.setGlobalCompositeOperation("source-over"),h&&this.context.clear(),this.context.drawImage(this.rootRenderTarget,e,t,i,r,n,a,s,o,i,r),this.context.$drawWebGL(),this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate(),this.restoreStencil(),this.restoreScissor()},s.drawSurfaceToFrameBuffer=function(e,t,i,r,n,a,s,o,h){void 0===h&&(h=!1),this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate(),this.context.disableStencilTest(),this.context.disableScissorTest(),this.setTransform(1,0,0,1,0,0),this.globalAlpha=1,this.context.setGlobalCompositeOperation("source-over"),h&&this.context.clear(),this.context.drawImage(this.context.surface,e,t,i,r,n,a,s,o,i,r),this.context.$drawWebGL(),this.rootRenderTarget.useFrameBuffer=!1,this.rootRenderTarget.activate(),this.restoreStencil(),this.restoreScissor()},s.clear=function(){this.context.clear()},s.setTransform=function(e,t,i,r,n,a){var s=this.globalMatrix;s.a=e,s.b=t,s.c=i,s.d=r,s.tx=n,s.ty=a},s.transform=function(e,t,i,r,n,a){var s=this.globalMatrix,o=s.a,h=s.b,u=s.c,c=s.d;(1!=e||0!=t||0!=i||1!=r)&&(s.a=e*o+t*u,s.b=e*h+t*c,s.c=i*o+r*u,s.d=i*h+r*c),s.tx=n*o+a*u+s.tx,s.ty=n*h+a*c+s.ty},s.translate=function(e,t){var i=this.globalMatrix;i.tx+=e,i.ty+=t},s.saveTransform=function(){var e=this.globalMatrix,t=this.savedGlobalMatrix;t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t.tx=e.tx,t.ty=e.ty},s.restoreTransform=function(){var e=this.globalMatrix,t=this.savedGlobalMatrix;e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.tx=t.tx,e.ty=t.ty},i.create=function(e,t){var n=r.pop();return n?n.resize(e,t):(n=new i(e,t),n.$computeDrawCall=!1),n},i.release=function(e){r.push(e)},i}();t.WebGLRenderBuffer=i,e.registerClass(i,"egret.native2.WebGLRenderBuffer",["egret.sys.RenderBuffer"]);var r=[]}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){function i(e,t){e=isNaN(e)?480:e,t=isNaN(t)?800:t;var i=new egret_native.Canvas(e,t);return i}var r=function(){function r(e,r){this.glID=null,this.projectionX=0/0,this.projectionY=0/0,this.shaderManager=null,this.contextLost=!1,this.$scissorState=!1,this.vertSize=5,this.blurFilter=null,this.surface=i(e,r),this.initWebGL(),this.$bufferStack=[];var n=this.context;this.vertexBuffer=n.createBuffer(),this.indexBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.drawCmdManager=new t.WebGLDrawCmdManager,this.vao=new t.WebGLVertexArrayObject,this.setGlobalCompositeOperation("source-over")}var n=(__define,r),a=n.prototype;return r.getInstance=function(e,t){return this.instance?this.instance:(this.instance=new r(e,t),this.instance)},a.pushBuffer=function(e){this.$bufferStack.push(e),e!=this.currentBuffer&&(this.currentBuffer,this.drawCmdManager.pushActivateBuffer(e)),this.currentBuffer=e},a.popBuffer=function(){if(!(this.$bufferStack.length<=1)){var e=this.$bufferStack.pop(),t=this.$bufferStack[this.$bufferStack.length-1];e!=t&&this.drawCmdManager.pushActivateBuffer(t),this.currentBuffer=t}},a.activateBuffer=function(e){e.rootRenderTarget.activate(),this.bindIndices||(this.uploadIndicesArray(this.vao.getIndices()),this.bindIndices=!0),e.restoreStencil(),e.restoreScissor(),this.onResize(e.width,e.height)},a.uploadVerticesArray=function(e){var t=this.context;t.bufferData(t.ARRAY_BUFFER,e,t.STREAM_DRAW)},a.uploadIndicesArray=function(e){var t=this.context;t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)},a.destroy=function(){this.surface.width=this.surface.height=0},a.onResize=function(e,t){var e=e||this.surface.width,t=t||this.surface.height;this.projectionX=e/2,this.projectionY=-t/2,this.context&&this.context.viewport(0,0,e,t)},a.resize=function(e,t,i){var r=this.surface;i?(r.width<e&&(r.width=e),r.height<t&&(r.height=t)):(r.width!=e&&(r.width=e),r.height!=t&&(r.height=t)),this.onResize()},a.initWebGL=function(){this.onResize(),this.getWebGLContext(),this.shaderManager=new t.WebGLShaderManager(this.context)},a.handleContextLost=function(){this.contextLost=!0},a.handleContextRestored=function(){this.initWebGL(),this.contextLost=!1},a.getWebGLContext=function(){for(var t,i={antialias:r.antialias,stencil:!0},n=["webgl","experimental-webgl"],a=0;a<n.length;a++){try{t=this.surface.getContext(n[a],i)}catch(s){}if(t)break}t||e.$error(1021),this.setContext(t)},a.setContext=function(e){this.context=e,e.id=r.glContextId++,this.glID=e.id,e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE),e.enable(e.BLEND),e.colorMask(!0,!0,!0,!0),e.activeTexture(e.TEXTURE0)},a.enableStencilTest=function(){var e=this.context;e.enable(e.STENCIL_TEST)},a.disableStencilTest=function(){var e=this.context;e.disable(e.STENCIL_TEST)},a.enableScissorTest=function(e){var t=this.context;t.enable(t.SCISSOR_TEST),t.scissor(e.x,e.y,e.width,e.height)},a.disableScissorTest=function(){var e=this.context;e.disable(e.SCISSOR_TEST)},a.getPixels=function(e,t,i,r,n){var a=this.context;a.readPixels(e,t,i,r,a.RGBA,a.UNSIGNED_BYTE,n)},a.createTexture=function(e){var t=this.context,i=t.createTexture();return i?(i.glContext=t,t.bindTexture(t.TEXTURE_2D,i),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),i):void(this.contextLost=!0)},a.createTextureFromCompressedData=function(e,t,i,r,n){return null},a.updateTexture=function(e,t){var i=this.context;i.bindTexture(i.TEXTURE_2D,e),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t)},a.getWebGLTexture=function(e){return e.webGLTexture||("image"==e.format?e.webGLTexture=this.createTexture(e.source):"pvr"==e.format&&(e.webGLTexture=this.createTextureFromCompressedData(e.source.pvrtcData,e.width,e.height,e.source.mipmapsCount,e.source.format)),e.$deleteSource&&e.webGLTexture&&(e.source=null)),e.webGLTexture},a.clearRect=function(e,t,i,r){if(0!=e||0!=t||i!=this.surface.width||r!=this.surface.height){var n=this.currentBuffer;if(n.$hasScissor)this.setGlobalCompositeOperation("destination-out"),this.drawRect(e,t,i,r),this.setGlobalCompositeOperation("source-over");else{var a=n.globalMatrix;0==a.b&&0==a.c?(e=e*a.a+a.tx,t=t*a.d+a.ty,i*=a.a,r*=a.d,this.enableScissor(e,-t-r+n.height,i,r),this.clear(),this.disableScissor()):(this.setGlobalCompositeOperation("destination-out"),this.drawRect(e,t,i,r),this.setGlobalCompositeOperation("source-over"))}}else this.clear()},a.setGlobalCompositeOperation=function(e){this.drawCmdManager.pushSetBlend(e)},a.drawImage=function(e,t,i,r,n,a,s,o,h,u,c){var l=this.currentBuffer;if(!this.contextLost&&e&&l){var d;if(e.source&&e.source.texture)d=e.source.texture,l.saveTransform(),l.transform(1,0,0,-1,0,h+2*s);else{if(!e.source&&!e.webGLTexture)return;d=this.getWebGLTexture(e)}d&&(this.drawTexture(d,t,i,r,n,a,s,o,h,u,c),e.source&&e.source.texture&&l.restoreTransform())}},a.drawMesh=function(e,t,i,r,n,a,s,o,h,u,c,l,d,f,v){var g=this.currentBuffer;if(!this.contextLost&&e&&g){var p;if(e.source&&e.source.texture)p=e.source.texture,g.saveTransform(),g.transform(1,0,0,-1,0,h+2*s);else{if(!e.source&&!e.webGLTexture)return;p=this.getWebGLTexture(e)}p&&this.drawTexture(p,t,i,r,n,a,s,o,h,u,c,l,d,f,v)}},a.drawTexture=function(e,t,i,r,n,a,s,o,h,u,c,l,d,f,v){var g=this.currentBuffer;if(!this.contextLost&&e&&g){d&&f?this.vao.reachMaxSize(d.length/2,f.length)&&this.$drawWebGL():this.vao.reachMaxSize()&&this.$drawWebGL(),l&&this.vao.changeToMeshIndices();var p=g.globalMatrix,x=g.globalAlpha,m=f?f.length/3:2;this.drawCmdManager.pushDrawTexture(e,m,this.$filter),this.vao.cacheArrays(p,x,t,i,r,n,a,s,o,h,u,c,l,d,f)}},a.drawRect=function(e,t,i,r){var n=this.currentBuffer;!this.contextLost&&n&&(this.vao.reachMaxSize()&&this.$drawWebGL(),this.drawCmdManager.pushDrawRect(),this.vao.cacheArrays(n.globalMatrix,n.globalAlpha,0,0,i,r,e,t,i,r,i,r))},a.pushMask=function(e){var t=this.currentBuffer;if(!this.contextLost&&t){t.$stencilList.push(e),this.vao.reachMaxSize()&&this.$drawWebGL();var i=e.length;if(i){this.drawCmdManager.pushPushMask(i);for(var r=0;i>r;r++){var n=e[r];this.vao.cacheArrays(t.globalMatrix,t.globalAlpha,0,0,n.width,n.height,n.minX,n.minY,n.width,n.height,n.width,n.height)}}else this.drawCmdManager.pushPushMask(),this.vao.cacheArrays(t.globalMatrix,t.globalAlpha,0,0,e.width,e.height,e.x,e.y,e.width,e.height,e.width,e.height)}},a.popMask=function(){var e=this.currentBuffer;if(!this.contextLost&&e){var t=e.$stencilList.pop();this.vao.reachMaxSize()&&this.$drawWebGL();var i=t.length;if(i){this.drawCmdManager.pushPopMask(i);for(var r=0;i>r;r++){var n=t[r];this.vao.cacheArrays(e.globalMatrix,e.globalAlpha,0,0,n.width,n.height,n.minX,n.minY,n.width,n.height,n.width,n.height)}}else this.drawCmdManager.pushPopMask(),this.vao.cacheArrays(e.globalMatrix,e.globalAlpha,0,0,t.width,t.height,t.x,t.y,t.width,t.height,t.width,t.height)}},a.clear=function(){this.drawCmdManager.pushClearColor()},a.enableScissor=function(e,t,i,r){var n=this.currentBuffer;this.drawCmdManager.pushEnableScissor(e,t,i,r),n.$hasScissor=!0},a.disableScissor=function(){var e=this.currentBuffer;this.drawCmdManager.pushDisableScissor(),e.$hasScissor=!1},a.$drawWebGL=function(){if(0!=this.drawCmdManager.drawDataLen&&!this.contextLost){this.uploadVerticesArray(this.vao.getVertices()),this.vao.isMesh()&&this.uploadIndicesArray(this.vao.getMeshIndices());for(var e=this.drawCmdManager.drawDataLen,t=0,i=0;e>i;i++){var r=this.drawCmdManager.drawData[i];t=this.drawData(r,t),7==r.type&&(this.activatedBuffer=r.buffer),(0==r.type||1==r.type||2==r.type||3==r.type)&&this.activatedBuffer&&this.activatedBuffer.$computeDrawCall&&this.activatedBuffer.$drawCalls++}this.vao.isMesh()&&this.uploadIndicesArray(this.vao.getIndices()),this.drawCmdManager.clear(),this.vao.clear()}},a.drawData=function(e,t){if(e){switch(e.type){case 0:var i,r=e.filter;r?"colorTransform"==r.type?(i=this.shaderManager.colorTransformShader,i.setMatrix(r.$matrix)):"blur"==r.type?(i=this.shaderManager.blurShader,i.setBlur(r.$blurX,r.$blurY),i.setTextureSize(e.textureWidth,e.textureHeight)):"glow"==r.type&&(i=this.shaderManager.glowShader,i.setDistance(r.$distance||0),i.setAngle(r.$angle?r.$angle/180*Math.PI:0),i.setColor(r.$red/255,r.$green/255,r.$blue/255),i.setAlpha(r.$alpha),i.setBlurX(r.$blurX),i.setBlurY(r.$blurY),i.setStrength(r.$strength),i.setInner(r.$inner?1:0),i.setKnockout(r.$knockout?0:1),i.setHideObject(r.$hideObject?1:0),i.setTextureSize(e.textureWidth,e.textureHeight)):i=this.shaderManager.defaultShader,i.setProjection(this.projectionX,this.projectionY),this.shaderManager.activateShader(i,4*this.vertSize),i.syncUniforms(),t+=this.drawTextureElements(e,t);break;case 1:var i=this.shaderManager.primitiveShader;i.setProjection(this.projectionX,this.projectionY),this.shaderManager.activateShader(i,4*this.vertSize),i.syncUniforms(),t+=this.drawRectElements(e,t);break;case 2:var i=this.shaderManager.primitiveShader;i.setProjection(this.projectionX,this.projectionY),this.shaderManager.activateShader(i,4*this.vertSize),i.syncUniforms(),t+=this.drawPushMaskElements(e,t);break;case 3:var i=this.shaderManager.primitiveShader;i.setProjection(this.projectionX,this.projectionY),this.shaderManager.activateShader(i,4*this.vertSize),i.syncUniforms(),t+=this.drawPopMaskElements(e,t);break;case 4:this.setBlendMode(e.value);break;case 5:e.buffer.rootRenderTarget.resize(e.width,e.height),this.onResize(e.width,e.height);break;case 6:if(this.activatedBuffer){var n=this.activatedBuffer.rootRenderTarget;(0!=n.width||0!=n.height)&&n.clear()}break;case 7:this.activateBuffer(e.buffer);break;case 8:var a=this.activatedBuffer;a&&a.enableScissor(e.x,e.y,e.width,e.height);break;case 9:var a=this.activatedBuffer;a&&a.disableScissor()}return t}},a.drawTextureElements=function(e,t){var i=this.context;i.bindTexture(i.TEXTURE_2D,e.texture);var r=3*e.count;return i.drawElements(i.TRIANGLES,r,i.UNSIGNED_SHORT,2*t),r},a.drawRectElements=function(e,t){var i=this.context,r=3*e.count;return i.drawElements(i.TRIANGLES,r,i.UNSIGNED_SHORT,2*t),r},a.drawPushMaskElements=function(e,t){var i=this.context,r=3*e.count,n=this.activatedBuffer;if(n){0==n.stencilHandleCount&&(n.enableStencil(),i.clear(i.STENCIL_BUFFER_BIT));var a=n.stencilHandleCount;n.stencilHandleCount++,i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.EQUAL,a,255),i.stencilOp(i.KEEP,i.KEEP,i.INCR),i.drawElements(i.TRIANGLES,r,i.UNSIGNED_SHORT,2*t),i.stencilFunc(i.EQUAL,a+1,255),i.colorMask(!0,!0,!0,!0),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)}return r},a.drawPopMaskElements=function(e,t){var i=this.context,r=3*e.count,n=this.activatedBuffer;if(n)if(n.stencilHandleCount--,0==n.stencilHandleCount)n.disableStencil();else{var a=n.stencilHandleCount;i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.EQUAL,a+1,255),i.stencilOp(i.KEEP,i.KEEP,i.DECR),i.drawElements(i.TRIANGLES,r,i.UNSIGNED_SHORT,2*t),i.stencilFunc(i.EQUAL,a,255),i.colorMask(!0,!0,!0,!0),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)}return r},a.setBlendMode=function(e){var t=this.context,i=r.blendModesForGL[e];i&&t.blendFunc(i[0],i[1])},a.drawTargetWidthFilters=function(e,i){var r,n=i,a=e.length;if(a>1)for(var s=0;a-1>s;s++){var o=e[s],h=i.rootRenderTarget.width,u=i.rootRenderTarget.height;r=t.WebGLRenderBuffer.create(h,u),r.setTransform(1,0,0,1,0,0),r.globalAlpha=1,this.drawToRenderTarget(o,i,r),i!=n&&t.WebGLRenderBuffer.release(i),i=r}var o=e[a-1];this.drawToRenderTarget(o,i,this.currentBuffer),i!=n&&t.WebGLRenderBuffer.release(i)},a.drawToRenderTarget=function(i,r,n){if(!this.contextLost){this.vao.reachMaxSize()&&this.$drawWebGL(),this.pushBuffer(n);var a,s=r,o=r.rootRenderTarget.width,h=r.rootRenderTarget.height;"blur"==i.type&&(this.blurFilter||(this.blurFilter=new e.BlurFilter(2,2)),0!=i.blurX&&0!=i.blurY?(this.blurFilter.blurX=i.blurX,this.blurFilter.blurY=0,a=t.WebGLRenderBuffer.create(o,h),a.setTransform(1,0,0,1,0,0),a.globalAlpha=1,this.drawToRenderTarget(this.blurFilter,r,a),r!=s&&t.WebGLRenderBuffer.release(r),r=a,this.blurFilter.blurX=0,this.blurFilter.blurY=i.blurY):(this.blurFilter.blurX=i.blurX,this.blurFilter.blurY=i.blurY),i=this.blurFilter),n.saveTransform(),n.transform(1,0,0,-1,0,h),this.vao.cacheArrays(n.globalMatrix,n.globalAlpha,0,0,o,h,0,0,o,h,o,h),n.restoreTransform();var u;u="blur"==i.type?{type:"blur",$blurX:i.$blurX,$blurY:i.$blurY}:i,this.drawCmdManager.pushDrawTexture(r.rootRenderTarget.texture,2,u,o,h),r!=s&&t.WebGLRenderBuffer.release(r),this.popBuffer()}},r.initBlendMode=function(){r.blendModesForGL={},r.blendModesForGL["source-over"]=[1,771],r.blendModesForGL.lighter=[1,772],r.blendModesForGL["lighter-in"]=[770,771],r.blendModesForGL["destination-out"]=[0,771],r.blendModesForGL["destination-in"]=[0,770]},r.glContextId=0,r.blendModesForGL=null,r}();t.WebGLRenderContext=r,e.registerClass(r,"egret.native2.WebGLRenderContext"),r.initBlendMode()}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(){function e(e,t,i){this.clearColor=[0,0,0,0],this.useFrameBuffer=!0,this.gl=e,this.width=t||1,this.height=i||1,this.texture=this.createTexture(),this.frameBuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0),this.stencilBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this.stencilBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,this.width,this.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,this.stencilBuffer)}var t=(__define,e),i=t.prototype;return i.resize=function(e,t){var i=this.gl;i.bindTexture(i.TEXTURE_2D,this.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,t,0,i.RGBA,i.UNSIGNED_BYTE,null),i.bindFramebuffer(i.FRAMEBUFFER,this.frameBuffer),i.bindRenderbuffer(i.RENDERBUFFER,this.stencilBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,e,t),this.width=e,this.height=t},i.activate=function(){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,this.getFrameBuffer())},i.getFrameBuffer=function(){return this.useFrameBuffer?this.frameBuffer:null},i.createTexture=function(){var e=this.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t},i.clear=function(e){var t=this.gl;e&&this.activate(),t.colorMask(!0,!0,!0,!0),t.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],this.clearColor[3]),t.clear(t.COLOR_BUFFER_BIT)},e}();t.WebGLRenderTarget=i,e.registerClass(i,"egret.native2.WebGLRenderTarget")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=["source-over","lighter","destination-out"],r="source-over",n=[],a=function(){function a(){this.nestLevel=0}var s=(__define,a),o=s.prototype;return o.render=function(e,t,i,r,a){this.nestLevel++;var s=t,o=s.context,h=a?e:null;o.pushBuffer(s),this.drawDisplayObject(e,s,r,i,null,null,h),o.$drawWebGL();var u=s.$drawCalls;if(s.onRenderFinish(),o.popBuffer(),this.nestLevel--,0===this.nestLevel){n.length>6&&(n.length=6);for(var c=n.length,l=0;c>l;l++)n[l].resize(0,0)}return u},o.drawDisplayObject=function(t,i,r,n,a,s,o){var h,u=0;if(a&&!o?(a.isDirty&&(u+=a.drawToSurface()),h=a.$renderNode):h=t.$getRenderNode(),h){if(r){var c=h.renderRegion;if(s&&!s.intersects(c))h.needRedraw=!1;else if(!h.needRedraw)for(var l=r.length,d=0;l>d;d++)if(c.intersects(r[d])){h.needRedraw=!0;break}}else h.needRedraw=!0;if(h.needRedraw){u++;var f,v;o?(f=t.$getConcatenatedAlphaAt(o,t.$getConcatenatedAlpha()),v=e.Matrix.create().copyFrom(t.$getConcatenatedMatrix()),t.$getConcatenatedMatrixAt(o,v),n.$preMultiplyInto(v,v),i.setTransform(v.a,v.b,v.c,v.d,v.tx,v.ty),e.Matrix.release(v)):(f=h.renderAlpha,v=h.renderMatrix,i.setTransform(v.a,v.b,v.c,v.d,v.tx+n.tx,v.ty+n.ty)),i.globalAlpha=f,this.renderNode(h,i),h.needRedraw=!1}}if(a&&!o)return u;var g=t.$children;if(g)for(var p=g.length,x=0;p>x;x++){var m=g[x];if(!(!m.$visible||m.$alpha<=0||m.$maskedObject)){var y=m.$getFilters();y&&y.length>0?u+=this.drawWithFilter(m,i,r,n,s,o):0!==m.$blendMode||m.$mask&&(m.$mask.$parentDisplayList||o)?u+=this.drawWithClip(m,i,r,n,s,o):m.$scrollRect||m.$maskRect?u+=this.drawWithScrollRect(m,i,r,n,s,o):m.isFPS?(i.context.$drawWebGL(),i.$computeDrawCall=!1,this.drawDisplayObject(m,i,r,n,m.$displayList,s,o),i.context.$drawWebGL(),i.$computeDrawCall=!0):u+=this.drawDisplayObject(m,i,r,n,m.$displayList,s,o)}}return u},o.drawWithFilter=function(t,a,s,o,h,u){var c=0,l=t.$getFilters(),d=0!==t.$blendMode;if(d){var f=i[t.$blendMode];f||(f=r)}if(1==l.length&&"colorTransform"==l[0].type&&!t.$children)return d&&a.context.setGlobalCompositeOperation(f),a.context.$filter=l[0],c+=this.drawDisplayObject(t,a,s,o,t.$displayList,h,u),a.context.$filter=null,d&&a.context.setGlobalCompositeOperation(r),c;var v=e.Matrix.create();v.copyFrom(t.$getConcatenatedMatrix());var g;g=e.sys.Region.create();var p=t.$getOriginalBounds();g.updateRegion(p,v);var x=this.createRenderBuffer(g.width,g.height);x.context.pushBuffer(x),x.setTransform(1,0,0,1,-g.minX,-g.minY);var m=e.Matrix.create().setTo(1,0,0,1,-g.minX,-g.minY);return c+=this.drawDisplayObject(t,x,s,m,t.$displayList,g,u),e.Matrix.release(m),x.context.popBuffer(),c>0&&(d&&a.context.setGlobalCompositeOperation(f),c++,a.globalAlpha=1,a.setTransform(1,0,0,1,g.minX+o.tx,g.minY+o.ty),a.context.drawTargetWidthFilters(l,x),d&&a.context.setGlobalCompositeOperation(r)),n.push(x),e.sys.Region.release(g),e.Matrix.release(v),c},o.drawWithClip=function(t,a,s,o,h,u){var c=0,l=0!==t.$blendMode;if(l){var d=i[t.$blendMode];d||(d=r)}var f=t.$scrollRect?t.$scrollRect:t.$maskRect,v=t.$mask,v=t.$mask;if(v){var g=v.$getRenderNode();if(g){var p=g.renderMatrix;if(0==p.a&&0==p.b||0==p.c&&0==p.d)return c}}var x,m=e.Matrix.create();if(m.copyFrom(t.$getConcatenatedMatrix()),t.$parentDisplayList){var y,b=t.$parentDisplayList.root;b!==t.$stage&&t.$getConcatenatedMatrixAt(b,m)}if(v){var T=v.$getOriginalBounds();x=e.sys.Region.create();var w=e.Matrix.create();w.copyFrom(v.$getConcatenatedMatrix()),y&&y.$preMultiplyInto(w,w),x.updateRegion(T,w),e.Matrix.release(w)}var S;if(f&&(S=e.sys.Region.create(),S.updateRegion(f,m)),S&&x?(S.intersect(x),e.sys.Region.release(x)):!S&&x&&(S=x),S){if(S.isEmpty()||h&&!h.intersects(S))return e.sys.Region.release(S),e.Matrix.release(m),c}else S=e.sys.Region.create(),T=t.$getOriginalBounds(),S.updateRegion(T,m);var E=!1;if(s){for(var R=s.length,_=0;R>_;_++)if(S.intersects(s[_])){E=!0;break}}else E=!0;if(!E)return e.sys.Region.release(S),e.Matrix.release(m),c;if(v||t.$children&&0!=t.$children.length){var C=this.createRenderBuffer(S.width,S.height);C.context.pushBuffer(C),C.setTransform(1,0,0,1,-S.minX,-S.minY);var L=e.Matrix.create().setTo(1,0,0,1,-S.minX,-S.minY);if(c+=this.drawDisplayObject(t,C,s,L,t.$displayList,S,u),v){var D=this.createRenderBuffer(S.width,S.height);D.context.pushBuffer(D),D.setTransform(1,0,0,1,-S.minX,-S.minY),L=e.Matrix.create().setTo(1,0,0,1,-S.minX,-S.minY);var $=this.drawDisplayObject(v,D,s,L,v.$displayList,S,u);if(D.context.popBuffer(),$>0){c+=$,C.context.setGlobalCompositeOperation("destination-in"),C.setTransform(1,0,0,-1,0,D.height),C.globalAlpha=1;var F=D.rootRenderTarget.width,M=D.rootRenderTarget.height;C.context.drawTexture(D.rootRenderTarget.texture,0,0,F,M,0,0,F,M,F,M),C.context.setGlobalCompositeOperation("source-over")}n.push(D)}if(e.Matrix.release(L),C.context.setGlobalCompositeOperation(r),C.context.popBuffer(),c>0){if(c++,l&&a.context.setGlobalCompositeOperation(d),f){var w=m;C.setTransform(w.a,w.b,w.c,w.d,w.tx-S.minX,w.ty-S.minY),C.context.pushMask(f)}a.globalAlpha=1,a.setTransform(1,0,0,-1,S.minX+o.tx,S.minY+o.ty+C.height);var A=C.rootRenderTarget.width,B=C.rootRenderTarget.height;a.context.drawTexture(C.rootRenderTarget.texture,0,0,A,B,0,0,A,B,A,B),f&&C.context.popMask(),l&&a.context.setGlobalCompositeOperation(r)}return n.push(C),e.sys.Region.release(S),e.Matrix.release(m),c}if(f){var w=m;a.setTransform(w.a,w.b,w.c,w.d,w.tx-S.minX,w.ty-S.minY),a.context.pushMask(f)}return l&&a.context.setGlobalCompositeOperation(d),c+=this.drawDisplayObject(t,a,s,o,t.$displayList,S,null),l&&a.context.setGlobalCompositeOperation(r),f&&a.context.popMask(),e.sys.Region.release(S),e.Matrix.release(m),c},o.drawWithScrollRect=function(t,i,r,n,a,s){var o=0,h=t.$scrollRect?t.$scrollRect:t.$maskRect;if(0==h.width||0==h.height)return o;var u=e.Matrix.create();if(u.copyFrom(t.$getConcatenatedMatrix()),s)t.$getConcatenatedMatrixAt(s,u);else if(t.$parentDisplayList){var c=t.$parentDisplayList.root;c!==t.$stage&&t.$getConcatenatedMatrixAt(c,u)}var l=e.sys.Region.create();if(h.isEmpty()||l.updateRegion(h,u),l.isEmpty()||a&&!a.intersects(l))return e.sys.Region.release(l),e.Matrix.release(u),o;var d=!1;if(r){for(var f=r.length,v=0;f>v;v++)if(l.intersects(r[v])){d=!0;break}}else d=!0;if(!d)return e.sys.Region.release(l),e.Matrix.release(u),o;i.setTransform(u.a,u.b,u.c,u.d,u.tx+n.tx,u.ty+n.ty);var g=i.context,p=!1;if(i.$hasScissor||0!=u.b||0!=u.c)g.pushMask(h);else{var x=h.x,m=h.y,y=h.width,b=h.height;x=x*u.a+u.tx+n.tx,m=m*u.d+u.ty+n.ty,y*=u.a,b*=u.d,g.enableScissor(x,-m-b+i.height,y,b),p=!0}return o+=this.drawDisplayObject(t,i,r,n,t.$displayList,l,s),i.setTransform(u.a,u.b,u.c,u.d,u.tx+n.tx,u.ty+n.ty),p?g.disableScissor():g.popMask(),e.sys.Region.release(l),e.Matrix.release(u),o},o.drawNodeToBuffer=function(e,t,i,r){var n=t;n.context.pushBuffer(n),n.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),this.renderNode(e,t,r),n.context.$drawWebGL(),n.onRenderFinish(),n.context.popBuffer()},o.renderNode=function(e,t,i){switch(e.type){case 1:this.renderBitmap(e,t);break;case 2:this.renderText(e,t);break;case 3:this.renderGraphics(e,t,i);break;case 4:this.renderGroup(e,t);break;case 6:t.globalAlpha=e.drawData[0];break;case 7:this.renderMesh(e,t)}},o.renderBitmap=function(e,t){var n=e.image;if(n){var a=e.drawData,s=a.length,o=0,h=e.matrix,u=e.blendMode,c=e.alpha;if(h&&(t.saveTransform(),t.transform(h.a,h.b,h.c,h.d,h.tx,h.ty)),u&&t.context.setGlobalCompositeOperation(i[u]),c==c){var l=t.globalAlpha;t.globalAlpha*=c}if(e.filter){for(t.context.$filter=e.filter;s>o;)t.context.drawImage(n,a[o++],a[o++],a[o++],a[o++],a[o++],a[o++],a[o++],a[o++],e.imageWidth,e.imageHeight);t.context.$filter=null}else for(;s>o;)t.context.drawImage(n,a[o++],a[o++],a[o++],a[o++],a[o++],a[o++],a[o++],a[o++],e.imageWidth,e.imageHeight);u&&t.context.setGlobalCompositeOperation(r),c==c&&(t.globalAlpha=l),h&&t.restoreTransform()
}},o.renderMesh=function(e,t){var i=e.image,r=e.drawData,n=r.length,a=0,s=e.matrix;for(s&&(t.saveTransform(),t.transform(s.a,s.b,s.c,s.d,s.tx,s.ty));n>a;)t.context.drawMesh(i,r[a++],r[a++],r[a++],r[a++],r[a++],r[a++],r[a++],r[a++],e.imageWidth,e.imageHeight,e.uvs,e.vertices,e.indices,e.bounds);s&&t.restoreTransform()},o.renderText=function(e,t){return},o.renderGraphics=function(e,t,i){return},o.renderGroup=function(e,t){for(var i=e.drawData,r=i.length,n=0;r>n;n++){var a=i[n];this.renderNode(a,t)}},o.createRenderBuffer=function(e,i){var r=n.pop();return r?r.resize(e,i):(r=new t.WebGLRenderBuffer(e,i),r.$computeDrawCall=!1),r},a}();t.WebGLRenderer=a,e.registerClass(a,"egret.native2.WebGLRenderer",["egret.sys.SystemRenderer"])}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(){function e(e){this.gl=null,this.maxAttibs=10,this.attribState=[],this.tempAttribState=[],this.currentShader=null,this.defaultShader=null,this.primitiveShader=null,this.colorTransformShader=null,this.blurShader=null,this.glowShader=null;for(var t=0;t<this.maxAttibs;t++)this.attribState[t]=!1;this.setContext(e)}var i=(__define,e),r=i.prototype;return r.setContext=function(e){this.gl=e,this.primitiveShader=new t.PrimitiveShader(e),this.defaultShader=new t.TextureShader(e),this.colorTransformShader=new t.ColorTransformShader(e),this.glowShader=new t.GlowShader(e),this.blurShader=new t.BlurShader(e),this.primitiveShader.init(),this.defaultShader.init(),this.colorTransformShader.init(),this.blurShader.init(),this.glowShader.init()},r.activateShader=function(e,t){this.currentShader!=e&&(this.gl.useProgram(e.program),this.setAttribs(e.attributes),e.setAttribPointer(t),this.currentShader=e)},r.setAttribs=function(e){var t,i;for(i=this.tempAttribState.length,t=0;i>t;t++)this.tempAttribState[t]=!1;for(i=e.length,t=0;i>t;t++){var r=e[t];this.tempAttribState[r]=!0}var n=this.gl;for(i=this.attribState.length,t=0;i>t;t++)this.attribState[t]!==this.tempAttribState[t]&&(this.attribState[t]=this.tempAttribState[t],this.tempAttribState[t]?n.enableVertexAttribArray(t):n.disableVertexAttribArray(t))},e}();t.WebGLShaderManager=i,e.registerClass(i,"egret.native2.WebGLShaderManager")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(){function t(){}var i=(__define,t);i.prototype;return t.compileProgram=function(i,r,n){var a=t.compileFragmentShader(i,n),s=t.compileVertexShader(i,r),o=i.createProgram();return i.attachShader(o,s),i.attachShader(o,a),i.linkProgram(o),i.getProgramParameter(o,i.LINK_STATUS)||e.$warn(1020),o},t.compileFragmentShader=function(e,i){return t._compileShader(e,i,e.FRAGMENT_SHADER)},t.compileVertexShader=function(e,i){return t._compileShader(e,i,e.VERTEX_SHADER)},t._compileShader=function(e,t,i){var r=e.createShader(i);return e.shaderSource(r,t),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)?r:null},t.checkCanUseWebGL=function(){if(void 0==t.canUseWebGL)try{var e=document.createElement("canvas");t.canUseWebGL=!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(i){t.canUseWebGL=!1}return t.canUseWebGL},t.deleteWebGLTexture=function(e){if(e){var t=e.glContext;t&&t.deleteTexture(e)}},t}();t.WebGLUtils=i,e.registerClass(i,"egret.native2.WebGLUtils"),e.WebGLUtils=i}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(){function e(){this.size=2e3,this.vertexMaxSize=4*this.size,this.indicesMaxSize=6*this.size,this.vertSize=5,this.vertices=null,this.indices=null,this.indicesForMesh=null,this.vertexIndex=0,this.indexIndex=0,this.hasMesh=!1;var e=this.vertexMaxSize*this.vertSize,t=this.indicesMaxSize;this.vertices=new Float32Array(e),this.indices=new Uint16Array(t),this.indicesForMesh=new Uint16Array(t);for(var i=0,r=0;t>i;i+=6,r+=4)this.indices[i+0]=r+0,this.indices[i+1]=r+1,this.indices[i+2]=r+2,this.indices[i+3]=r+0,this.indices[i+4]=r+2,this.indices[i+5]=r+3}var t=(__define,e),i=t.prototype;return i.reachMaxSize=function(e,t){return void 0===e&&(e=4),void 0===t&&(t=6),this.vertexIndex>this.vertexMaxSize-e||this.indexIndex>this.indicesMaxSize-t},i.getVertices=function(){var e=this.vertices.subarray(0,this.vertexIndex*this.vertSize);return e},i.getIndices=function(){return this.indices},i.getMeshIndices=function(){return this.indicesForMesh},i.changeToMeshIndices=function(){if(!this.hasMesh){for(var e=0,t=this.indexIndex;t>e;++e)this.indicesForMesh[e]=this.indices[e];this.hasMesh=!0}},i.isMesh=function(){return this.hasMesh},i.cacheArrays=function(e,t,i,r,n,a,s,o,h,u,c,l,d,f,v){var g=e,p=g.a,x=g.b,m=g.c,y=g.d,b=g.tx,T=g.ty;(0!=s||0!=o)&&g.append(1,0,0,1,s,o),(n/h!=1||a/u!=1)&&g.append(h/n,0,0,u/a,0,0);var w=g.a,S=g.b,E=g.c,R=g.d,_=g.tx,C=g.ty;if(g.a=p,g.b=x,g.c=m,g.d=y,g.tx=b,g.ty=T,f){var L=this.vertices,D=this.vertexIndex*this.vertSize,$=0,F=0,M=0,A=0,B=0,O=0,P=0;for($=0,M=d.length;M>$;$+=2)F=5*$/2,O=f[$],P=f[$+1],A=d[$],B=d[$+1],L[D+F+0]=w*O+E*P+_,L[D+F+1]=S*O+R*P+C,L[D+F+2]=(i+A*n)/c,L[D+F+3]=(r+B*a)/l,L[D+F+4]=t;if(this.hasMesh)for(var $=0,M=v.length;M>$;++$)this.indicesForMesh[this.indexIndex+$]=v[$]+this.vertexIndex;this.vertexIndex+=d.length/2,this.indexIndex+=v.length}else{var I=c,G=l,N=n,W=a;i/=I,r/=G,n/=I,a/=G;var L=this.vertices,D=this.vertexIndex*this.vertSize;if(L[D++]=_,L[D++]=C,L[D++]=i,L[D++]=r,L[D++]=t,L[D++]=w*N+_,L[D++]=S*N+C,L[D++]=n+i,L[D++]=r,L[D++]=t,L[D++]=w*N+E*W+_,L[D++]=R*W+S*N+C,L[D++]=n+i,L[D++]=a+r,L[D++]=t,L[D++]=E*W+_,L[D++]=R*W+C,L[D++]=i,L[D++]=a+r,L[D++]=t,this.hasMesh){var k=this.indicesForMesh;k[this.indexIndex+0]=0+this.vertexIndex,k[this.indexIndex+1]=1+this.vertexIndex,k[this.indexIndex+2]=2+this.vertexIndex,k[this.indexIndex+3]=0+this.vertexIndex,k[this.indexIndex+4]=2+this.vertexIndex,k[this.indexIndex+5]=3+this.vertexIndex}this.vertexIndex+=4,this.indexIndex+=6}},i.clear=function(){this.hasMesh=!1,this.vertexIndex=0,this.indexIndex=0},e}();t.WebGLVertexArrayObject=i,e.registerClass(i,"egret.native2.WebGLVertexArrayObject")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(){function e(e){this.defaultVertexSrc="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec2 aColor;\nuniform vec2 projectionVector;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nconst vec2 center = vec2(-1.0, 1.0);\nvoid main(void) {\n   gl_Position = vec4( (aVertexPosition / projectionVector) + center , 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vColor = vec4(aColor.x, aColor.x, aColor.x, aColor.x);\n}",this.fragmentSrc="",this.gl=null,this.program=null,this.uniforms={projectionVector:{type:"2f",value:{x:0,y:0},dirty:!0}},this.gl=e}var i=(__define,e),r=i.prototype;return r.init=function(){var e=this.gl,i=t.WebGLUtils.compileProgram(e,this.defaultVertexSrc,this.fragmentSrc);e.useProgram(i),this.aVertexPosition=e.getAttribLocation(i,"aVertexPosition"),this.aTextureCoord=e.getAttribLocation(i,"aTextureCoord"),this.colorAttribute=e.getAttribLocation(i,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var r in this.uniforms)this.uniforms[r].uniformLocation=e.getUniformLocation(i,r);this.initUniforms(),this.program=i},r.initUniforms=function(){if(this.uniforms){var e,t=this.gl;for(var i in this.uniforms){e=this.uniforms[i],e.dirty=!0;var r=e.type;"mat2"===r||"mat3"===r||"mat4"===r?(e.glMatrix=!0,e.glValueLength=1,"mat2"===r?e.glFunc=t.uniformMatrix2fv:"mat3"===r?e.glFunc=t.uniformMatrix3fv:"mat4"===r&&(e.glFunc=t.uniformMatrix4fv)):(e.glFunc=t["uniform"+r],"2f"===r||"2i"===r?e.glValueLength=2:"3f"===r||"3i"===r?e.glValueLength=3:"4f"===r||"4i"===r?e.glValueLength=4:e.glValueLength=1)}}},r.syncUniforms=function(){if(this.uniforms){var e,t=this.gl;for(var i in this.uniforms)e=this.uniforms[i],e.dirty&&(1===e.glValueLength?e.glMatrix===!0?e.glFunc.call(t,e.uniformLocation,e.transpose,e.value):e.glFunc.call(t,e.uniformLocation,e.value):2===e.glValueLength?e.glFunc.call(t,e.uniformLocation,e.value.x,e.value.y):3===e.glValueLength?e.glFunc.call(t,e.uniformLocation,e.value.x,e.value.y,e.value.z):4===e.glValueLength&&e.glFunc.call(t,e.uniformLocation,e.value.x,e.value.y,e.value.z,e.value.w),e.dirty=!1)}},r.setProjection=function(e,t){var i=this.uniforms.projectionVector;(i.value.x!=e||i.value.y!=t)&&(i.value.x=e,i.value.y=t,i.dirty=!0)},r.setAttribPointer=function(e){var t=this.gl;t.vertexAttribPointer(this.aVertexPosition,2,t.FLOAT,!1,e,0),t.vertexAttribPointer(this.aTextureCoord,2,t.FLOAT,!1,e,8),t.vertexAttribPointer(this.colorAttribute,1,t.FLOAT,!1,e,16)},e}();t.EgretShader=i,e.registerClass(i,"egret.native2.EgretShader")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(e){function t(){e.apply(this,arguments),this.fragmentSrc="precision lowp float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nuniform sampler2D uSampler;\nvoid main(void) {\ngl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;\n}"}__extends(t,e);var i=(__define,t);i.prototype;return t}(t.EgretShader);t.TextureShader=i,e.registerClass(i,"egret.native2.TextureShader")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(e){function t(){e.apply(this,arguments),this.fragmentSrc="precision mediump float;uniform vec2 blur;uniform sampler2D uSampler;varying vec2 vTextureCoord;uniform vec2 uTextureSize;void main(){const int sampleRadius = 5;const int samples = sampleRadius * 2 + 1;vec2 blurUv = blur / uTextureSize;vec4 color = vec4(0, 0, 0, 0);vec2 uv = vec2(0.0, 0.0);blurUv /= float(sampleRadius);for (int i = -sampleRadius; i <= sampleRadius; i++) {uv.x = vTextureCoord.x + float(i) * blurUv.x;uv.y = vTextureCoord.y + float(i) * blurUv.y;color += texture2D(uSampler, uv);}color /= float(samples);gl_FragColor = color;}",this.uniforms={projectionVector:{type:"2f",value:{x:0,y:0},dirty:!0},blur:{type:"2f",value:{x:2,y:2},dirty:!0},uTextureSize:{type:"2f",value:{x:100,y:100},dirty:!0}}}__extends(t,e);var i=(__define,t),r=i.prototype;return r.setBlur=function(e,t){var i=this.uniforms.blur;(i.value.x!=e||i.value.y!=t)&&(i.value.x=e,i.value.y=t,i.dirty=!0)},r.setTextureSize=function(e,t){var i=this.uniforms.uTextureSize;(e!=i.value.x||t!=i.value.y)&&(i.value.x=e,i.value.y=t,i.dirty=!0)},t}(t.TextureShader);t.BlurShader=i,e.registerClass(i,"egret.native2.BlurShader")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(e){function t(){e.apply(this,arguments),this.fragmentSrc="precision mediump float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nuniform mat4 matrix;\nuniform vec4 colorAdd;\nuniform sampler2D uSampler;\nvoid main(void) {\nvec4 texColor = texture2D(uSampler, vTextureCoord);\nif(texColor.a > 0.) {texColor = vec4(texColor.rgb / texColor.a, texColor.a);\n}vec4 locColor = clamp(texColor * matrix + colorAdd, 0., 1.);\ngl_FragColor = vColor * vec4(locColor.rgb * locColor.a, locColor.a);\n}",this.uniforms={projectionVector:{type:"2f",value:{x:0,y:0},dirty:!0},matrix:{type:"mat4",value:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),dirty:!0},colorAdd:{type:"4f",value:{x:0,y:0,z:0,w:0},dirty:!0}}}__extends(t,e);var i=(__define,t),r=i.prototype;return r.setMatrix=function(e){var t=this.uniforms.matrix;(t.value[0]!=e[0]||t.value[0]!=e[0]||t.value[1]!=e[1]||t.value[2]!=e[2]||t.value[3]!=e[3]||t.value[4]!=e[5]||t.value[5]!=e[6]||t.value[6]!=e[7]||t.value[7]!=e[8]||t.value[8]!=e[10]||t.value[9]!=e[11]||t.value[10]!=e[12]||t.value[11]!=e[13]||t.value[12]!=e[15]||t.value[13]!=e[16]||t.value[14]!=e[17]||t.value[15]!=e[18])&&(t.value[0]=e[0],t.value[1]=e[1],t.value[2]=e[2],t.value[3]=e[3],t.value[4]=e[5],t.value[5]=e[6],t.value[6]=e[7],t.value[7]=e[8],t.value[8]=e[10],t.value[9]=e[11],t.value[10]=e[12],t.value[11]=e[13],t.value[12]=e[15],t.value[13]=e[16],t.value[14]=e[17],t.value[15]=e[18],t.dirty=!0);var i=this.uniforms.colorAdd;(i.value.x!=e[4]/255||i.value.y!=e[9]/255||i.value.z!=e[14]/255||i.value.w!=e[19]/255)&&(i.value.x=e[4]/255,i.value.y=e[9]/255,i.value.z=e[14]/255,i.value.w=e[19]/255,i.dirty=!0)},t}(t.TextureShader);t.ColorTransformShader=i,e.registerClass(i,"egret.native2.ColorTransformShader")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(e){function t(){e.apply(this,arguments),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform sampler2D uSampler;","uniform float distance;","uniform float angle;","uniform vec4 color;","uniform float alpha;","uniform float blurX;","uniform float blurY;","uniform float strength;","uniform float inner;","uniform float knockout;","uniform float hideObject;","uniform vec2 uTextureSize;vec2 px = vec2(1.0 / uTextureSize.x, 1.0 / uTextureSize.y);","float random(vec3 scale, float seed)","{","return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);","}","void main(void) {","const float linearSamplingTimes = 7.0;","const float circleSamplingTimes = 12.0;","vec4 ownColor = texture2D(uSampler, vTextureCoord);","vec4 curColor;","float totalAlpha = 0.0;","float maxTotalAlpha = 0.0;","float curDistanceX = 0.0;","float curDistanceY = 0.0;","float offsetX = distance * cos(angle) * px.x;","float offsetY = distance * sin(angle) * px.y;","const float PI = 3.14159265358979323846264;","float cosAngle;","float sinAngle;","float offset = PI * 2.0 / circleSamplingTimes * random(vec3(12.9898, 78.233, 151.7182), 0.0);","float stepX = blurX * px.x / linearSamplingTimes;","float stepY = blurY * px.y / linearSamplingTimes;","for (float a = 0.0; a <= PI * 2.0; a += PI * 2.0 / circleSamplingTimes) {","cosAngle = cos(a + offset);","sinAngle = sin(a + offset);","for (float i = 1.0; i <= linearSamplingTimes; i++) {","curDistanceX = i * stepX * cosAngle;","curDistanceY = i * stepY * sinAngle;","curColor = texture2D(uSampler, vec2(vTextureCoord.x + curDistanceX - offsetX, vTextureCoord.y + curDistanceY + offsetY));","totalAlpha += (linearSamplingTimes - i) * curColor.a;","maxTotalAlpha += (linearSamplingTimes - i);","}","}","ownColor.a = max(ownColor.a, 0.0001);","ownColor.rgb = ownColor.rgb / ownColor.a;","float outerGlowAlpha = (totalAlpha / maxTotalAlpha) * strength * alpha * (1. - inner) * max(min(hideObject, knockout), 1. - ownColor.a);","float innerGlowAlpha = ((maxTotalAlpha - totalAlpha) / maxTotalAlpha) * strength * alpha * inner * ownColor.a;","ownColor.a = max(ownColor.a * knockout * (1. - hideObject), 0.0001);","vec3 mix1 = mix(ownColor.rgb, color.rgb, innerGlowAlpha / (innerGlowAlpha + ownColor.a));","vec3 mix2 = mix(mix1, color.rgb, outerGlowAlpha / (innerGlowAlpha + ownColor.a + outerGlowAlpha));","float resultAlpha = min(ownColor.a + outerGlowAlpha + innerGlowAlpha, 1.);","gl_FragColor = vec4(mix2 * resultAlpha, resultAlpha);","}"].join("\n"),this.uniforms={projectionVector:{type:"2f",value:{x:0,y:0},dirty:!0},distance:{type:"1f",value:15,dirty:!0},angle:{type:"1f",value:1,dirty:!0},color:{type:"4f",value:{x:1,y:0,z:0,w:0},dirty:!0},alpha:{type:"1f",value:1,dirty:!0},blurX:{type:"1f",value:1,dirty:!0},blurY:{type:"1f",value:1,dirty:!0},strength:{type:"1f",value:1,dirty:!0},inner:{type:"1f",value:1,dirty:!0},knockout:{type:"1f",value:1,dirty:!0},hideObject:{type:"1f",value:0,dirty:!0},uTextureSize:{type:"2f",value:{x:100,y:100},dirty:!0}}}__extends(t,e);var i=(__define,t),r=i.prototype;return r.setDistance=function(e){var t=this.uniforms.distance;t.value!=e&&(t.value=e,t.dirty=!0)},r.setAngle=function(e){var t=this.uniforms.angle;t.value!=e&&(t.value=e,t.dirty=!0)},r.setColor=function(e,t,i){var r=this.uniforms.color;(r.value.x!=e||r.value.y!=t||r.value.z!=i)&&(r.value.x=e,r.value.y=t,r.value.z=i,r.dirty=!0)},r.setAlpha=function(e){var t=this.uniforms.alpha;t.value!=e&&(t.value=e,t.dirty=!0)},r.setBlurX=function(e){var t=this.uniforms.blurX;t.value!=e&&(t.value=e,t.dirty=!0)},r.setBlurY=function(e){var t=this.uniforms.blurY;t.value!=e&&(t.value=e,t.dirty=!0)},r.setStrength=function(e){var t=this.uniforms.strength;t.value!=e&&(t.value=e,t.dirty=!0)},r.setInner=function(e){var t=this.uniforms.inner;t.value!=e&&(t.value=e,t.dirty=!0)},r.setKnockout=function(e){var t=this.uniforms.knockout;t.value!=e&&(t.value=e,t.dirty=!0)},r.setHideObject=function(e){var t=this.uniforms.hideObject;t.value!=e&&(t.value=e,t.dirty=!0)},r.setTextureSize=function(e,t){var i=this.uniforms.uTextureSize;(e!=i.value.x||t!=i.value.y)&&(i.value.x=e,i.value.y=t,i.dirty=!0)},t}(t.TextureShader);t.GlowShader=i,e.registerClass(i,"egret.native2.GlowShader")}(t=e.native2||(e.native2={}))}(egret||(egret={}));var egret;!function(e){var t;!function(t){var i=function(e){function t(){e.apply(this,arguments),this.fragmentSrc="precision lowp float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvoid main(void) {\ngl_FragColor = vColor;\n}"}__extends(t,e);var i=(__define,t);i.prototype;return t}(t.EgretShader);t.PrimitiveShader=i,e.registerClass(i,"egret.native2.PrimitiveShader")}(t=e.native2||(e.native2={}))}(egret||(egret={}));